(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c5ed23f2","chunk-1d7a8041"],{"0f6a":function(e,t,n){"use strict";(function(e){var i,a=n("3835"),r=n("53ca");"object"===Object(r["a"])(e)&&i?i=e.exports:"undefined"!==typeof window&&(i=window["eviltransform"]={});var o=6378137;function s(e,t){return t<72.004||t>137.8347||(e<.8293||e>55.8271)}function c(e,t){var n=e*t,i=Math.sqrt(Math.abs(e)),a=e*Math.PI,r=t*Math.PI,o=20*Math.sin(6*a)+20*Math.sin(2*a),s=o,c=o;return s+=20*Math.sin(r)+40*Math.sin(r/3),c+=20*Math.sin(a)+40*Math.sin(a/3),s+=160*Math.sin(r/12)+320*Math.sin(r/30),c+=150*Math.sin(a/12)+300*Math.sin(a/30),s*=2/3,c*=2/3,s+=2*e-100+3*t+.2*t*t+.1*n+.2*i,c+=300+e+2*t+.1*e*e+.1*n+.1*i,{lat:s,lng:c}}function l(e,t){var n=.006693421622965943,i=c(t-105,e-35),a=e/180*Math.PI,r=Math.sin(a);r=1-n*r*r;var s=Math.sqrt(r);return i.lat=180*i.lat/(o*(1-n)/(r*s)*Math.PI),i.lng=180*i.lng/(o/s*Math.cos(a)*Math.PI),i}function d(e,t){if(s(e,t))return{lat:e,lng:t};var n=l(e,t);return{lat:e+n.lat,lng:t+n.lng}}function u(e,t){if(s(e,t))return{lat:e,lng:t};var n=l(e,t);return{lat:e-n.lat,lng:t-n.lng}}function h(e,t){for(var n=e,i=t,a=n,r=i,o=1e-6,s=0;s<30;s++){a=n,r=i;var c=d(n,i);if(n-=e-c.lat,i-=t-c.lng,Math.max(Math.abs(a-n),Math.abs(r-i))<o)break}return{lat:n,lng:i}}function p(e,t,n,i){var a=Math.PI/180,r=e*a,s=n*a,c=Math.cos(r)*Math.cos(s)*Math.cos((t-i)*a),l=Math.sin(r)*Math.sin(s),d=c+l;d>1&&(d=1),d<-1&&(d=-1);var u=Math.acos(d),h=u*o;return h}function g(e,t){if(s(e,t))return{lat:e,lng:t};var n=t,i=e,a=Math.sqrt(n*n+i*i)+2e-5*Math.sin(i*Math.PI),r=Math.atan2(i,n)+3e-6*Math.cos(n*Math.PI),o=a*Math.cos(r)+.0065,c=a*Math.sin(r)+.006;return{lat:c,lng:o}}function f(e,t){if(s(e,t))return{lat:e,lng:t};var n=t-.0065,i=e-.006,a=Math.sqrt(n*n+i*i)-2e-5*Math.sin(i*Math.PI),r=Math.atan2(i,n)-3e-6*Math.cos(n*Math.PI),o=a*Math.cos(r),c=a*Math.sin(r);return{lat:c,lng:o}}function v(e,t){var n=d(e,t);return g(n.lat,n.lng)}function m(e,t){var n=f(e,t);return u(n.lat,n.lng)}i.wgs2gcj=d,i.gcj2wgs=u,i.gcj2wgs_exact=h,i.distance=p,i.gcj2bd=g,i.bd2gcj=f,i.wgs2bd=v,i.bd2wgs=m;var y=i;i.a_wgs2gcj=function(e){var t=Object(a["a"])(e,2),n=t[0],i=t[1],r=d(i,n);return[r.lng,r.lat]},t["a"]=y}).call(this,n("dd40")(e))},3723:function(e,t,n){"use strict";var i=n("bdb9"),a=n.n(i);a.a},"5e43":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"dashboard-editor-container"},[n("el-row",{staticStyle:{background:"white"}},[n("el-row",{staticStyle:{margin:"10px"},attrs:{gutter:10}},[n("el-col",{attrs:{lg:3}},[n("el-select",{attrs:{loading:e.controllerDeviceLoading,filterable:"",remote:"","reserve-keyword":"","remote-method":e.fetchControllerDevices,placeholder:"请选择控制设备"},on:{focus:function(t){return e.fetchControllerDevices("")}},model:{value:e.controllerDeviceId,callback:function(t){e.controllerDeviceId=t},expression:"controllerDeviceId"}},e._l(e.operationDevices,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[n("span",[e._v(e._s(t.name))])])})),1)],1),n("el-col",{attrs:{lg:3}},[n("el-select",{attrs:{loading:e.operationDeviceLoading,filterable:"",remote:"","reserve-keyword":"","remote-method":e.fetchOptionDevices,placeholder:"请选择作业设备"},on:{focus:function(t){return e.fetchOptionDevices("")}},model:{value:e.operationDeviceId,callback:function(t){e.operationDeviceId=t},expression:"operationDeviceId"}},e._l(e.operationDevices,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[n("span",[e._v(e._s(t.name))])])})),1)],1),n("el-col",{staticStyle:{"margin-top":"3px"},attrs:{lg:2}},[n("el-button",{attrs:{type:e.connectBtnOptions[e.isConnect].color,size:"small"},on:{click:e.handleConnect}},[e._v(e._s(e.connectBtnOptions[e.isConnect].text)+" ")])],1),n("el-col",{staticStyle:{"margin-top":"3px"},attrs:{lg:6}},[n("el-divider",{attrs:{direction:"vertical"}}),n("el-button",{attrs:{type:"success",plain:"",size:"small",disabled:!e.isConnect||e.tracking.disabled},on:{click:e.handleTraceDialog}},[e._v("寻迹 ")]),n("el-button",{attrs:{type:"primary",plain:"",size:"small",disabled:!e.isConnect||e.operating.disabled},on:{click:e.handleParallelDrive}},[e._v("驾驶 ")]),n("el-button",{attrs:{type:"warning",plain:"",size:"small",disabled:!e.isConnect||e.standby.disabled},on:{click:e.handleStandby}},[e._v("停止 ")]),n("el-button",{attrs:{type:"danger",plain:"",size:"small",disabled:!e.isConnect||e.shutdown.disabled},on:{click:e.handleShutdown}},[e._v("关机 ")]),n("el-divider",{attrs:{direction:"vertical"}})],1),n("div",{staticStyle:{"margin-top":"10px",float:"right","margin-right":"10px"}},[n("el-tooltip",{attrs:{content:"设备状态",placement:"bottom",effect:"light"}},[n("span",{staticClass:"metric-icon",staticStyle:{color:"#909399"}},[n("svg-icon",{attrs:{"icon-class":"status"}}),e._v(" "+e._s(e.deviceState.label))],1)]),n("el-divider",{attrs:{direction:"vertical"}}),n("el-tooltip",{attrs:{content:"设备模式",placement:"bottom",effect:"light"}},[n("span",{staticClass:"metric-icon",staticStyle:{color:"#909399"}},[n("svg-icon",{attrs:{"icon-class":"model"}}),e._v(" "+e._s(e.controlModel.label))],1)]),n("el-divider",{attrs:{direction:"vertical"}}),n("el-tooltip",{attrs:{content:"信号延迟",placement:"bottom",effect:"light"}},[n("span",{staticClass:"metric-icon",staticStyle:{color:"#909399"}},[n("svg-icon",{attrs:{"icon-class":"single"}}),e._v(" "+e._s(e.signal)+"ms")],1)]),n("el-divider",{attrs:{direction:"vertical"}}),n("el-tooltip",{attrs:{content:"GPS强度",placement:"bottom",effect:"light"}},[n("span",{staticClass:"metric-icon",staticStyle:{color:"#909399"}},[n("svg-icon",{attrs:{"icon-class":"gps"}}),e._v(" "+e._s(e.gps))],1)])],1)],1)],1),n("el-row",{style:{height:e.winHeight-192+"px"}},[n("el-col",{attrs:{lg:19}},[n("el-tabs",{staticStyle:{background:"white"},attrs:{"tab-position":"bottom",stretch:!0}},[n("el-tab-pane",{style:{height:e.winHeight-240+"px"},attrs:{label:"实时地图"}},[n("real-time-map",{attrs:{cId:e.channelId+"-map"}})],1),n("el-tab-pane",{style:{height:e.winHeight-240+"px"},attrs:{label:"寻迹路线"}},[n("trace-monitor",{attrs:{cId:e.channelId+"-trace"}})],1),n("el-tab-pane",{style:{height:e.winHeight-240+"px"},attrs:{label:"监控视频"}},[n("video-monitor",{attrs:{cId:e.channelId+"-video"}})],1)],1)],1),n("el-col",{staticStyle:{height:"100%","overflow-y":"auto"},attrs:{lg:5}},[n("el-row",{staticStyle:{height:"220px",margin:"6px"}},[n("div",{staticClass:"metric-chart",attrs:{id:"leftVelocityChart"}})]),n("el-row",{staticStyle:{height:"220px",margin:"6px"}},[n("div",{staticClass:"metric-chart",attrs:{id:"rightVelocityChart"}})]),n("el-row",{staticStyle:{height:"220px",margin:"6px"}},[n("div",{staticClass:"metric-chart",attrs:{id:"velocityChart"}})]),n("el-row",{staticStyle:{height:"220px",margin:"6px"}},[n("div",{staticClass:"metric-chart",attrs:{id:"powerChart"}})])],1)],1)],1),n("el-dialog",{attrs:{title:"寻迹路线下发",visible:e.tracking.dialog},on:{"update:visible":function(t){return e.$set(e.tracking,"dialog",t)}}},[n("el-form",{ref:"trackingForm",attrs:{model:e.tracking,rules:e.trackingFormRules}},[n("el-form-item",{attrs:{label:"寻迹速度",prop:"speed"}},[n("el-input",{model:{value:e.tracking.speed,callback:function(t){e.$set(e.tracking,"speed",t)},expression:"tracking.speed"}})],1),n("el-form-item",{attrs:{label:"寻迹路线",prop:"route"}},[n("el-select",{attrs:{placeholder:"请选择寻迹路线"},model:{value:e.tracking.route,callback:function(t){e.$set(e.tracking,"route",t)},expression:"tracking.route"}},e._l(e.tracking.routes,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.locations}},[n("span",[e._v(e._s(t.name))])])})),1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.tracking.dialog=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.handleTracking}},[e._v("确定")])],1)],1)],1)},a=[],r=(n("d81d"),n("a9e3"),n("d3b7"),n("ac1f"),n("466d"),n("96cf"),n("1da1")),o=n("d530"),s=n("ba89"),c=n("e298"),l=n("ec26"),d=n("a692"),u=n("b775");function h(e,t){return Object(u["a"])({url:"/api/v1/operating/device/"+e+"/binds",method:"post",params:{targetId:t}})}function p(e){return Object(u["a"])({url:"/api/v1/operating/device/"+e+"/detail",method:"get"})}function g(e,t,n){var i=new FormData;return i.append("type",t),i.append("body",n),Object(u["a"])({url:"/api/v1/operating/command/"+e,method:"post",data:i})}var f=n("e1c6");function v(e){var t=new Date;console.log("["+t.toLocaleTimeString()+"] "+e)}var m=n("98c3"),y=null,b=null,C=null,M=null,w=null,S=null,O=null,k=null,I={name:"operating-remote",components:{RealTimeMap:o["default"],TraceMonitor:s["default"],VideoMonitor:c["default"]},data:function(){return{channelId:Object(l["a"])(),winHeight:window.innerHeight,winWidth:window.innerWidth,operationDeviceId:null,controllerDeviceId:null,operationDeviceLoading:!1,controllerDeviceLoading:!1,operationDevices:[],connectBtnOptions:{false:{color:"primary",text:"连接"},true:{color:"danger",text:"断开"}},isConnect:!1,deviceState:{label:"离线状态"},controlModel:{label:"静止模式"},deviceStates:{offline:{label:"离线状态"},online:{label:"在线状态"}},controlModels:{standby:{label:"静止模式"},operating:{label:"平行驾驶模式"},tracking:{label:"自动驾驶模式"}},signal:0,gps:0,tracking:{dialog:!1,disabled:!1,speed:null,route:null,routes:[]},operating:{dialog:!1,disabled:!1},standby:{dialog:!1,disabled:!0},shutdown:{dialog:!1,disabled:!1},trackingFormRules:{speed:[{required:!0,message:"请输入寻迹速度",trigger:"blur"}],route:[{required:!0,message:"请选择寻迹路线",trigger:"blur"}]},deviceDetail:null,traceRoute:null,eventHandlers:{},channels:{map:null,trace:null,video:null},EVENT_WS_CONNECTION:null,EMQ_CONNECTION:null}},mounted:function(){var e=this;window.onresize=function(){e.winHeight=window.innerHeight,e.winWidth=window.innerWidth},this.initCharts(),this.initChannels()},methods:{handleConnect:function(){if(this.isConnect)this.destroyConnections();else{if(!this.controllerDeviceId||!this.operationDeviceId)return void this.$message({type:"error",message:"请选择作业设备和控制设备!"});this.createBinding()}},fetchOptionDevices:function(e){var t=this;this.operationDeviceLoading=!0,Object(d["f"])(1,100,e,"machinery").then((function(e){var n=e["data"];t.operationDevices=n["list"]})).finally((function(){t.operationDeviceLoading=!1}))},fetchControllerDevices:function(e){var t=this;this.controllerDeviceLoading=!0,Object(d["f"])(1,100,e,"controller").then((function(e){var n=e["data"];t.operationDevices=n["list"]})).finally((function(){t.controllerDeviceLoading=!1}))},handleTraceDialog:function(){var e=this;this.tracking.route=null,this.tracking.speed=null,Object(f["a"])("",1,100).then((function(t){e.tracking.routes=t["data"]["list"],e.tracking.dialog=!0}))},createBinding:function(){var e=this;h(this.controllerDeviceId,this.operationDeviceId).then((function(t){v("设备绑定成功。"),v("初始化WebSocket连接……"),e.initEventsWebSocketConnection(),v("初始化WebRtc连接……"),e.initWetRtcMqttConnection(),e.loadDeviceDetail()}))},initChannels:function(){var e=this,t=new BroadcastChannel(this.channelId+"-map"),n=new BroadcastChannel(this.channelId+"-trace"),i=new BroadcastChannel(this.channelId+"-video");t.onmessage=function(t){e.onChannelMessage(t,e.onMapChannelMessage)},n.onmessage=function(t){e.onChannelMessage(t,e.onTraceChannelMessage)},i.onmessage=function(t){var n=JSON.parse(t.data),i=n.type,a=n.payload;e.onVideoChannelMessage(i,a)},this.channels["map"]=t,this.channels["trace"]=n,this.channels["video"]=i},onChannelMessage:function(e,t){var n=e.data.type,i=e.data.data;t(n,i)},onMapChannelMessage:function(e,t){},onTraceChannelMessage:function(e,t){switch(e){case"registry":this.broadcastTraceLines()}},broadcastTraceLines:function(){this.tracking.route&&this.channels["trace"].postMessage({type:"trace-lines",data:this.tracking.route})},onVideoChannelMessage:function(e,t){switch(v("BroadCastChannel message arrived: "+e),e){case"send-message":this.sendMessageToEMQ(t);break;case"registry":this.broadcastRtcOptions();break;case"video-active":this.broadcastRtcOptions();break}},sendMessageToEMQ:function(e){var t=JSON.stringify(e);v("Send message to emq: "+t);var n=new Paho.MQTT.Message(t);n.destinationName=this.emqOptions.requestTopic,this.EMQ_CONNECTION.send(n)},initWetRtcMqttConnection:function(){var e=this;Object(d["c"])(this.operationDeviceId).then((function(t){var n=t["data"]["ciphertext"],i=m.Certificate.deserializeBinary(n);e.emqOptions={clientId:i.getRtcvideoclientid()+"/"+e.channelId.substr(0,4),requestTopic:i.getRtcvideoreqtopic(),answerTopic:i.getRtcvideoanstopic(),emqUrl:i.getUrl(),emqUsername:i.getUsername(),emqPassword:i.getPassword()},e.EMQ_CONNECTION=e.createEMQClient(e.emqOptions),e.rtcOptions={iceServerUrls:i.getIceserverurls(),iceServerUsername:i.getIceserverusername(),iceServerCredential:i.getIceservercredential()}}))},createEMQClient:function(e){var t,n,i=this,a=e.emqUrl.match(/^(.+):\/\/(.+):(\d+)/);if(!a)throw new Error(e.emqUrl);t=a[2],n=8083;var r=new Paho.MQTT.Client(t,n,e.clientId);return r.connect({userName:e.emqUsername,password:e.emqPassword,onSuccess:function(){v("EMQ客户端已连接。"),r.subscribe(e.answerTopic),v("广播并初始化RTC配置。"),i.broadcastRtcOptions()}}),r.onConnectionLost=function(e){return v("EMQ客户端已连接失去连接。")},r.onMessageArrived=this.onEMQMessageArrived,r},broadcastRtcOptions:function(){this.rtcOptions&&this.channels["video"]&&this.channels["video"].postMessage(JSON.stringify({type:"init-rtc-connection",payload:this.rtcOptions}))},onEMQMessageArrived:function(e){console.log("EMQ message arrived: "+e.payloadString);var t=JSON.parse(e.payloadString);this.channels["video"].postMessage(JSON.stringify({type:t.type,payload:t}))},initEventsWebSocketConnection:function(){null!==this.EVENT_WS_CONNECTION&&this.EVENT_WS_CONNECTION.close(),this.EVENT_WS_CONNECTION=new WebSocket("ws://"+window.location.host+"/api/v1/operating/ws/events/"+this.operationDeviceId),this.EVENT_WS_CONNECTION.onmessage=this.eventBusOnMessage,this.EVENT_WS_CONNECTION.onopen=this.eventBusOnOpen,this.EVENT_WS_CONNECTION.onclose=this.eventBusOnClose},destroyConnections:function(){this.EVENT_WS_CONNECTION&&this.EVENT_WS_CONNECTION.close(),this.EMQ_CONNECTION&&this.EMQ_CONNECTION.disconnect()},destroyChannels:function(){for(var e in this.channels){var t=this.channels[e];t&&t.close()}},controlStateMachine:function(e){switch(e){case"standby":return this.tracking.disabled=!1,this.operating.disabled=!1,void(this.shutdown.disabled=!1);case"tracking":return this.standby.disabled=!1,this.tracking.disabled=!0,this.operating.disabled=!0,void(this.shutdown.disabled=!0);case"operating":return this.standby.disabled=!1,this.tracking.disabled=!0,this.operating.disabled=!0,void(this.shutdown.disabled=!0)}},handleTracking:function(){this.controlStateMachine("tracking");var e=JSON.stringify({speed:Number(this.tracking.speed),route:this.tracking.route});this.sendCommand(this.operationDeviceId,"control-mode","tracking"),this.sendCommand(this.operationDeviceId,"auto-drive",e),this.broadcastTraceLines(),this.tracking.dialog=!1},handleParallelDrive:function(){var e=this;this.$confirm("平行驾驶指令下发后，您可以使用控制器设备进行远程驾驶, 是否继续?","平行指令下发",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.controlStateMachine("operating"),e.sendCommand(e.operationDeviceId,"control-mode","operating")})).catch((function(){}))},handleStandby:function(){var e=this;this.$confirm("静止指令下发后，设备将停止作业，处于静止等待状态, 是否继续?","静止指令下发",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.controlStateMachine("standby"),e.sendCommand(e.operationDeviceId,"control-mode","standby")})).catch((function(){}))},handleShutdown:function(){var e=this;this.$confirm("关机指令下发后，设备将停止作业，并进行系统关机, 是否继续?","关机指令下发",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((function(){e.sendCommand(e.operationDeviceId,"shutdown",(new Date).getTime())})).catch((function(){}))},loadDeviceDetail:function(){var e=this;p(this.operationDeviceId).then((function(t){var n=t["data"];e.deviceDetail=n;var i=n["status"];e.deviceStates.hasOwnProperty(i)&&(e.deviceState=e.deviceStates[i]);var a=n["controlState"];e.controlModels.hasOwnProperty(i)&&(e.controlModel=e.controlModels[a],e.controlStateMachine(e.controlModel))}))},sendCommand:function(e,t,n){var i=this;g(e,t,n).then((function(e){i.$message.success("指令下发成功！")}))},eventBusOnMessage:function(e){var t=JSON.parse(e["data"]),n=t["type"]["type"];this.eventHandlers.hasOwnProperty(n)&&this.eventHandlers[n](t)},eventBusOnOpen:function(){v("WebSocket已经连接。"),this.registryEventHandlers(),this.isConnect=!0},eventBusOnClose:function(e){console.log("WebSocket已关闭。"),this.isConnect=!1},registryEventHandlers:function(){var e=this;this.eventHandlers["location"]=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=JSON.parse(n["body"]),e.channels["trace"]&&e.channels["trace"].postMessage({type:"location",data:i}),e.channels["map"]&&e.channels["map"].postMessage({type:"location",data:i}),e.gps=parseInt(i["status"]);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.eventHandlers["delay"]=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.signal=parseInt(n["body"]);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.eventHandlers["left-track-velocity"]=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:null!=y&&null!=C&&(y.series[0].data[0].value=parseFloat(t["body"]),C.setOption({series:y.series}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.eventHandlers["right-track-velocity"]=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:null!=b&&null!=M&&(b.series[0].data[0].value=parseFloat(t["body"]),M.setOption({series:b.series}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.eventHandlers["velocity"]=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:null!=S&&null!=w&&(S.series[0].data[0].value=parseFloat(t["body"]),w.setOption({series:S.series}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.eventHandlers["power"]=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:null!=O&&null!=k&&(O.series[0].data[0].value=parseInt(t["body"]),k.setOption({series:O.series}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.eventHandlers["online"]=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.deviceState=e.deviceStates["online"];case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.eventHandlers["offline"]=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.deviceState=e.deviceStates["offline"];case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.eventHandlers["control-state"]=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=n["body"],e.controlModels.hasOwnProperty(i)&&(e.controlModel=e.controlModels[i]);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},initCharts:function(){this.createLeftVelocityChart(),this.createRightVelocityChart(),this.createVelocityChart(),this.createPowerChart()},createLeftVelocityChart:function(){y={tooltip:{formatter:"{b} : {c}%"},series:[{name:"左履带速度",title:{show:!0,offsetCenter:["0%","-35%"],textStyle:{fontSize:14,color:"#1C1C1C",transparent:!0,shadowColor:"#fff"}},pointer:{width:4},detail:{formatter:"{value}%",offsetCenter:["0%","40%"],textStyle:{fontWeight:"bolder",fontSize:16}},axisLabel:{textStyle:{fontWeight:"bolder"}},axisLine:{lineStyle:{color:[[.2,"#F44336"],[.8,"#03A9F4"],[1,"#F44336"]],shadowColor:"#fff",width:6}},splitLine:{length:10,lineStyle:{}},center:["50%","55%"],type:"gauge",radius:"98%",data:[{value:0,name:"左履带车速"}],min:-100,max:100}]},C=echarts.init(document.getElementById("leftVelocityChart")),C.setOption(y)},createRightVelocityChart:function(){b={tooltip:{formatter:"{b} : {c}%"},series:[{name:"右履带速度",title:{show:!0,offsetCenter:["0%","-35%"],textStyle:{fontSize:14,color:"#1C1C1C",transparent:!0,shadowColor:"#fff"}},pointer:{width:4},detail:{formatter:"{value}%",offsetCenter:["0%","40%"],textStyle:{fontWeight:"bolder",fontSize:16}},axisLabel:{textStyle:{fontWeight:"bolder"}},axisLine:{lineStyle:{color:[[.2,"#F44336"],[.8,"#03A9F4"],[1,"#F44336"]],shadowColor:"#fff",width:6}},splitLine:{length:10,lineStyle:{}},center:["50%","55%"],type:"gauge",radius:"98%",data:[{value:0,name:"右履带车速"}],min:-100,max:100}]},M=echarts.init(document.getElementById("rightVelocityChart")),M.setOption(b)},createVelocityChart:function(){S={tooltip:{formatter:"{b} : {c}m/s"},series:[{name:"速度",startAngle:220,endAngle:0,title:{show:!0,offsetCenter:["0%","-35%"],textStyle:{fontSize:14,color:"#1C1C1C",transparent:!0,shadowColor:"#fff"}},pointer:{width:4},detail:{formatter:"{value}m/s",offsetCenter:["0%","40%"],textStyle:{fontWeight:"bolder",fontSize:16}},axisLabel:{textStyle:{fontWeight:"bolder"}},axisLine:{lineStyle:{color:[[.4,"#8BC34A"],[.8,"#03A9F4"],[1,"#F44336"]],shadowColor:"#fff",width:6}},splitLine:{length:10,lineStyle:{}},center:["50%","55%"],type:"gauge",radius:"98%",data:[{value:0,name:"车速"}],min:0,max:2}]},w=echarts.init(document.getElementById("velocityChart")),w.setOption(S)},createPowerChart:function(){O={tooltip:{formatter:"{b} : {c}%"},series:[{name:"电量",startAngle:220,endAngle:40,splitNumber:4,title:{show:!0,offsetCenter:["0%","-35%"],textStyle:{fontSize:14,color:"#1C1C1C",transparent:!0,shadowColor:"#fff"}},pointer:{width:4},detail:{formatter:"{value}%",offsetCenter:["0%","40%"],textStyle:{fontWeight:"bolder",fontSize:16}},axisLabel:{textStyle:{fontWeight:"bolder"}},axisLine:{lineStyle:{color:[[.2,"#F44336"],[.8,"#03A9F4"],[1,"#8BC34A"]],shadowColor:"#fff",width:6}},splitLine:{length:10,lineStyle:{}},center:["50%","55%"],type:"gauge",radius:"98%",data:[{value:0,name:"电量"}],min:0,max:100}]},k=echarts.init(document.getElementById("powerChart")),k.setOption(O)}},beforeDestroy:function(){this.destroyChannels(),this.destroyConnections()}},x=I,D=(n("66eb"),n("2877")),E=Object(D["a"])(x,i,a,!1,null,"43fd82fd",null);t["default"]=E.exports},"66eb":function(e,t,n){"use strict";var i=n("ef69"),a=n.n(i);a.a},"98c3":function(e,t,n){var i=n("8513"),a=i,r=Function("return this")();a.exportSymbol("proto.Certificate",null,r),proto.Certificate=function(e){i.Message.initialize(this,e,0,-1,null,null)},a.inherits(proto.Certificate,i.Message),a.DEBUG&&!COMPILED&&(proto.Certificate.displayName="proto.Certificate"),i.Message.GENERATE_TO_OBJECT&&(proto.Certificate.prototype.toObject=function(e){return proto.Certificate.toObject(e,this)},proto.Certificate.toObject=function(e,t){var n={deviceid:i.Message.getFieldWithDefault(t,1,0),url:i.Message.getFieldWithDefault(t,2,""),qos:i.Message.getFieldWithDefault(t,3,0),username:i.Message.getFieldWithDefault(t,4,""),password:i.Message.getFieldWithDefault(t,5,""),clientid:i.Message.getFieldWithDefault(t,6,""),eventtopic:i.Message.getFieldWithDefault(t,7,""),commandtopic:i.Message.getFieldWithDefault(t,8,""),rtcvideoclientid:i.Message.getFieldWithDefault(t,9,""),rtcvideoreqtopic:i.Message.getFieldWithDefault(t,10,""),rtcvideoanstopic:i.Message.getFieldWithDefault(t,11,""),rtcdataclientid:i.Message.getFieldWithDefault(t,12,""),rtcdatareqtopic:i.Message.getFieldWithDefault(t,13,""),rtcdataanstopic:i.Message.getFieldWithDefault(t,14,""),iceserverurls:i.Message.getFieldWithDefault(t,15,""),iceserverusername:i.Message.getFieldWithDefault(t,16,""),iceservercredential:i.Message.getFieldWithDefault(t,17,"")};return e&&(n.$jspbMessageInstance=t),n}),proto.Certificate.deserializeBinary=function(e){var t=new i.BinaryReader(e),n=new proto.Certificate;return proto.Certificate.deserializeBinaryFromReader(n,t)},proto.Certificate.deserializeBinaryFromReader=function(e,t){while(t.nextField()){if(t.isEndGroup())break;var n=t.getFieldNumber();switch(n){case 1:var i=t.readInt32();e.setDeviceid(i);break;case 2:i=t.readString();e.setUrl(i);break;case 3:i=t.readInt32();e.setQos(i);break;case 4:i=t.readString();e.setUsername(i);break;case 5:i=t.readString();e.setPassword(i);break;case 6:i=t.readString();e.setClientid(i);break;case 7:i=t.readString();e.setEventtopic(i);break;case 8:i=t.readString();e.setCommandtopic(i);break;case 9:i=t.readString();e.setRtcvideoclientid(i);break;case 10:i=t.readString();e.setRtcvideoreqtopic(i);break;case 11:i=t.readString();e.setRtcvideoanstopic(i);break;case 12:i=t.readString();e.setRtcdataclientid(i);break;case 13:i=t.readString();e.setRtcdatareqtopic(i);break;case 14:i=t.readString();e.setRtcdataanstopic(i);break;case 15:i=t.readString();e.setIceserverurls(i);break;case 16:i=t.readString();e.setIceserverusername(i);break;case 17:i=t.readString();e.setIceservercredential(i);break;default:t.skipField();break}}return e},proto.Certificate.prototype.serializeBinary=function(){var e=new i.BinaryWriter;return proto.Certificate.serializeBinaryToWriter(this,e),e.getResultBuffer()},proto.Certificate.serializeBinaryToWriter=function(e,t){var n=void 0;n=e.getDeviceid(),0!==n&&t.writeInt32(1,n),n=e.getUrl(),n.length>0&&t.writeString(2,n),n=e.getQos(),0!==n&&t.writeInt32(3,n),n=e.getUsername(),n.length>0&&t.writeString(4,n),n=e.getPassword(),n.length>0&&t.writeString(5,n),n=e.getClientid(),n.length>0&&t.writeString(6,n),n=e.getEventtopic(),n.length>0&&t.writeString(7,n),n=e.getCommandtopic(),n.length>0&&t.writeString(8,n),n=e.getRtcvideoclientid(),n.length>0&&t.writeString(9,n),n=e.getRtcvideoreqtopic(),n.length>0&&t.writeString(10,n),n=e.getRtcvideoanstopic(),n.length>0&&t.writeString(11,n),n=e.getRtcdataclientid(),n.length>0&&t.writeString(12,n),n=e.getRtcdatareqtopic(),n.length>0&&t.writeString(13,n),n=e.getRtcdataanstopic(),n.length>0&&t.writeString(14,n),n=e.getIceserverurls(),n.length>0&&t.writeString(15,n),n=e.getIceserverusername(),n.length>0&&t.writeString(16,n),n=e.getIceservercredential(),n.length>0&&t.writeString(17,n)},proto.Certificate.prototype.getDeviceid=function(){return i.Message.getFieldWithDefault(this,1,0)},proto.Certificate.prototype.setDeviceid=function(e){return i.Message.setProto3IntField(this,1,e)},proto.Certificate.prototype.getUrl=function(){return i.Message.getFieldWithDefault(this,2,"")},proto.Certificate.prototype.setUrl=function(e){return i.Message.setProto3StringField(this,2,e)},proto.Certificate.prototype.getQos=function(){return i.Message.getFieldWithDefault(this,3,0)},proto.Certificate.prototype.setQos=function(e){return i.Message.setProto3IntField(this,3,e)},proto.Certificate.prototype.getUsername=function(){return i.Message.getFieldWithDefault(this,4,"")},proto.Certificate.prototype.setUsername=function(e){return i.Message.setProto3StringField(this,4,e)},proto.Certificate.prototype.getPassword=function(){return i.Message.getFieldWithDefault(this,5,"")},proto.Certificate.prototype.setPassword=function(e){return i.Message.setProto3StringField(this,5,e)},proto.Certificate.prototype.getClientid=function(){return i.Message.getFieldWithDefault(this,6,"")},proto.Certificate.prototype.setClientid=function(e){return i.Message.setProto3StringField(this,6,e)},proto.Certificate.prototype.getEventtopic=function(){return i.Message.getFieldWithDefault(this,7,"")},proto.Certificate.prototype.setEventtopic=function(e){return i.Message.setProto3StringField(this,7,e)},proto.Certificate.prototype.getCommandtopic=function(){return i.Message.getFieldWithDefault(this,8,"")},proto.Certificate.prototype.setCommandtopic=function(e){return i.Message.setProto3StringField(this,8,e)},proto.Certificate.prototype.getRtcvideoclientid=function(){return i.Message.getFieldWithDefault(this,9,"")},proto.Certificate.prototype.setRtcvideoclientid=function(e){return i.Message.setProto3StringField(this,9,e)},proto.Certificate.prototype.getRtcvideoreqtopic=function(){return i.Message.getFieldWithDefault(this,10,"")},proto.Certificate.prototype.setRtcvideoreqtopic=function(e){return i.Message.setProto3StringField(this,10,e)},proto.Certificate.prototype.getRtcvideoanstopic=function(){return i.Message.getFieldWithDefault(this,11,"")},proto.Certificate.prototype.setRtcvideoanstopic=function(e){return i.Message.setProto3StringField(this,11,e)},proto.Certificate.prototype.getRtcdataclientid=function(){return i.Message.getFieldWithDefault(this,12,"")},proto.Certificate.prototype.setRtcdataclientid=function(e){return i.Message.setProto3StringField(this,12,e)},proto.Certificate.prototype.getRtcdatareqtopic=function(){return i.Message.getFieldWithDefault(this,13,"")},proto.Certificate.prototype.setRtcdatareqtopic=function(e){return i.Message.setProto3StringField(this,13,e)},proto.Certificate.prototype.getRtcdataanstopic=function(){return i.Message.getFieldWithDefault(this,14,"")},proto.Certificate.prototype.setRtcdataanstopic=function(e){return i.Message.setProto3StringField(this,14,e)},proto.Certificate.prototype.getIceserverurls=function(){return i.Message.getFieldWithDefault(this,15,"")},proto.Certificate.prototype.setIceserverurls=function(e){return i.Message.setProto3StringField(this,15,e)},proto.Certificate.prototype.getIceserverusername=function(){return i.Message.getFieldWithDefault(this,16,"")},proto.Certificate.prototype.setIceserverusername=function(e){return i.Message.setProto3StringField(this,16,e)},proto.Certificate.prototype.getIceservercredential=function(){return i.Message.getFieldWithDefault(this,17,"")},proto.Certificate.prototype.setIceservercredential=function(e){return i.Message.setProto3StringField(this,17,e)},a.object.extend(t,proto)},a692:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"f",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"g",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"c",(function(){return d}));var i=n("b775");function a(e,t){return Object(i["a"])({url:"/api/v1/devicemgr/devices/records",method:"get",params:{pageNum:e,pageSize:t}})}function r(e,t,n,a){return Object(i["a"])({url:"/api/v1/devicemgr/devices",method:"get",params:{pageNum:e,pageSize:t,deviceName:n,deviceType:a}})}function o(e,t,n){return Object(i["a"])({url:"/api/v1/devicemgr/devices",method:"post",params:{name:e,description:t,type:n}})}function s(e,t,n,a){return Object(i["a"])({url:"/api/v1/devicemgr/devices/"+e,method:"put",params:{name:t,description:n,type:a}})}function c(e){return Object(i["a"])({url:"/api/v1/devicemgr/devices/"+e,method:"delete"})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Object(i["a"])({url:"/api/v1/devicemgr/types",method:"get",params:{pageNum:e,pageSize:t}})}function d(e){return Object(i["a"])({url:"/api/v1/devicemgr/devices/"+e+"/certificate",method:"get"})}},bdb9:function(e,t,n){},d530:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%",width:"100%"},attrs:{id:"real-time-map"},on:{dblclick:e.maximize}},[e.channel?e._e():n("div",{staticStyle:{"text-align":"center",height:"100%"}},[e._v("地图组件初始化失败")])])},a=[],r=(n("d81d"),n("fb6a"),n("a434"),n("b85c")),o=n("0f6a"),s={name:"RealTimeMap",props:{cId:{type:String,required:!1}},data:function(){return{channel:null,map:null,mapCenter:null,carMarker:null,lines:[],maxLineCapacity:1e3,lastLocation:null}},created:function(){var e=this,t=this.cId?this.cId:this.$route.params.cid;t&&(this.channel=new BroadcastChannel(t),this.channel.onmessage=function(t){var n=t.data.type,i=t.data.data;e.onChannelMessage(n,i)},this.$nextTick((function(){e.createMap(o["a"]["a_wgs2gcj"]([117.1482253804925,36.69067493933744,0]))})))},methods:{createMap:function(e){if(!this.map){var t=new AMap.Map("real-time-map",{center:e,resizeEnable:!0,layers:[new AMap.TileLayer.Satellite],zoom:20});AMap.plugin(["AMap.MapType","AMap.Geolocation"],(function(){t.addControl(new AMap.MapType),t.addControl(new AMap.Geolocation)})),this.map=t}},onChannelMessage:function(e,t){switch(e){case"location":this.handleLocationMessage(t);break}},handleLocationMessage:function(e){var t=o["a"]["a_wgs2gcj"]([e["lng"],e["lat"]]),n=e["angle"];if(this.map){if(this.mapCenter||(this.mapCenter=t,this.map.setCenter(this.mapCenter)),this.lines.length===this.maxLineCapacity){var i=this.lines.slice(0,this.maxLineCapacity-1);this.lines.splice(0,this.maxLineCapacity);var a,s=Object(r["a"])(i);try{for(s.s();!(a=s.n()).done;){var c=a.value;this.map.remove(c)}}catch(u){s.e(u)}finally{s.f()}}null==this.carMarker&&(this.carMarker=new AMap.Marker({position:t,icon:"https://webapi.amap.com/images/car.png",offset:new AMap.Pixel(-26,-13),autoRotation:!0,angle:-90,title:"作业设备"}),this.map.add(this.carMarker)),this.carMarker.setAngle(n+270),this.lastLocation||(this.lastLocation=t);var l=[this.lastLocation,t],d=new AMap.Polyline({map:this.map,path:l,showDir:!0,strokeColor:"#28F",strokeWeight:6});this.lines.push(d),this.carMarker.moveAlong(l,1e3),this.lastLocation=t}},maximize:function(){window.open("#/expand/map/"+this.cId)}},beforeDestroy:function(){this.channel&&this.channel.close(),this.map&&this.map.destroy()}},c=s,l=n("2877"),d=Object(l["a"])(c,i,a,!1,null,"1f120136",null);t["default"]=d.exports},e1c6:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o}));var i=n("b775");function a(e,t,n){return Object(i["a"])({url:"/api/v1/devicemgr/traceroute",method:"get",params:{name:e,pageNum:t,pageSize:n}})}function r(e){return Object(i["a"])({url:"/api/v1/devicemgr/traceroute/"+e,method:"delete"})}function o(e){return Object(i["a"])({url:"/api/v1/devicemgr/traceroute/save",method:"post",data:e})}},e298:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%",width:"100%"},attrs:{id:"video-monitor"}},[n("el-row",{staticStyle:{height:"50%"},attrs:{gutter:20}},[n("el-col",{staticClass:"video",attrs:{sm:24,md:12}},[n("ExpandVideo",{attrs:{channelId:e.channelId,cameraId:"front"}})],1),n("el-col",{staticClass:"video1",attrs:{sm:24,md:12}},[n("ExpandVideo",{attrs:{channelId:e.channelId,cameraId:"rear"}})],1)],1),n("el-row",{staticStyle:{height:"50%"},attrs:{gutter:20}},[n("el-col",{staticClass:"video",attrs:{sm:24,md:12}},[n("ExpandVideo",{attrs:{channelId:e.channelId,cameraId:"left"}})],1),n("el-col",{staticClass:"video1",attrs:{sm:24,md:12}},[n("ExpandVideo",{attrs:{channelId:e.channelId,cameraId:"right"}})],1)],1),e.channel?e._e():n("div",{staticStyle:{"text-align":"center",height:"100%"}},[e._v("视频监控组件初始化失败")])],1)},a=[],r=(n("d3b7"),{name:"VideoMonitor",components:{ExpandVideo:function(){return n.e("chunk-2050818b").then(n.bind(null,"88dd"))}},props:{cId:{type:String,required:!1}},data:function(){return{channel:null,channelId:null,isExpand:!1}},methods:{maximize:function(){this.isExpand||(this.channel.postMessage(JSON.stringify({type:"video-destroy",payload:{id:"all"}})),window.open("#/expand/video/"+this.cId))}},created:function(){var e=this.cId?this.cId:this.$route.params.cid;this.isExpand=this.$route.params.cid,e&&(this.channelId=e,this.channel=new BroadcastChannel(e),this.$nextTick((function(){})))},mounted:function(){}}),o=r,s=(n("3723"),n("2877")),c=Object(s["a"])(o,i,a,!1,null,"32122d58",null);t["default"]=c.exports},ef69:function(e,t,n){}}]);